"use strict";var gulp=require("gulp"),browserSync=require("browser-sync"),plumber=require("gulp-plumber"),del=require("del"),tinypng=require("gulp-tinypng-compress"),imagemin=require("gulp-imagemin"),imageminJpegRecompress=require("imagemin-jpeg-recompress"),pngquant=require("imagemin-pngquant"),newer=require("gulp-newer"),rigger=require("gulp-rigger"),concat=require("gulp-concat"),uglify=require("gulp-uglify"),sourcemaps=require("gulp-sourcemaps"),sass=require("gulp-sass"),autoprefixer=require("gulp-autoprefixer"),cleancss=require("gulp-clean-css"),pug=require("gulp-pug"),kit=require("gulp-kit"),svgSprite=require("gulp-svg-sprite"),svgmin=require("gulp-svgmin"),cheerio=require("gulp-cheerio"),replace=require("gulp-replace"),BrowserSyncConfig={server:{baseDir:"./build"},tunnel:!1,host:"localhost",port:3e3,notify:!1,online:!1},filePath={pug:{in:"./src/pug/*.pug",out:"./build/"},kit:{in:"src/kit/*.kit",out:"./build/"},sass:{in:"./src/sass/style.scss",out:"build/css/"},jsLibs:{in:["./src/js/libs/#AddLibs.js"],out:"build/js"},jsScripts:{in:"./src/js/*.js",out:"build/js"},img:{in:["src/img/**/*","!src/img/svg/**/*","!src/img/_compress/**/*"],out:"./build/img/",compImgCache:"./src/img/_compress/",tinyPngApiKey:"78UEHTVIN19cuH3B5ZsGUaTWJ6Vsv3Ev"},svg:{in:"./src/img/svg/*.svg",out:"./build/img/svg"},fonts:{in:"./src/fonts/**/*",out:"build/fonts/"},cleaner:"build/*"};gulp.task("pug",function(){return gulp.src(filePath.pug.in).pipe(plumber()).pipe(pug({pretty:!0})).pipe(gulp.dest(filePath.pug.out)).on("end",browserSync.reload)}),gulp.task("kit",function(){return gulp.src(filePath.kit.in).pipe(plumber()).pipe(kit()).pipe(gulp.dest(filePath.kit.out)).on("end",browserSync.reload)}),gulp.task("sassDev",function(){return gulp.src(filePath.sass.in).pipe(plumber()).pipe(sourcemaps.init()).pipe(sass().on("error",function(e){console.log(e)})).pipe(autoprefixer({overrideBrowserslist:["last 10 versions"]})).pipe(sourcemaps.write(".")).pipe(gulp.dest(filePath.sass.out)).pipe(browserSync.stream())}),gulp.task("sassBuild",function(){return gulp.src(filePath.sass.in).pipe(sass({outputStyle:"compressed"})).pipe(cleancss({level:{1:{specialComments:0}}})).pipe(autoprefixer({overrideBrowserslist:["last 10 versions"]})).pipe(gulp.dest(filePath.sass.out))}),gulp.task("libsDev",function(){return gulp.src(filePath.jsLibs.in).pipe(plumber()).pipe(sourcemaps.init()).pipe(rigger()).pipe(concat("libs.js")).pipe(sourcemaps.write(".")).pipe(gulp.dest(filePath.jsLibs.out)).pipe(browserSync.stream())}),gulp.task("libsBuild",function(){return gulp.src(filePath.jsLibs.in).pipe(rigger()).pipe(concat("libs.js")).pipe(uglify()).pipe(gulp.dest(filePath.jsLibs.out))}),gulp.task("scriptsDev",function(){return gulp.src(filePath.jsScripts.in).pipe(plumber()).pipe(gulp.dest(filePath.jsScripts.out)).pipe(browserSync.stream())}),gulp.task("scriptsBuild",function(){return gulp.src(filePath.jsScripts.in).pipe(uglify()).pipe(gulp.dest(filePath.jsScripts.out))}),gulp.task("imgMover",function(){return gulp.src(filePath.img.in).pipe(newer(filePath.img.out)).pipe(gulp.dest(filePath.img.out))}),gulp.task("tinyPngMover",function(){return gulp.src(["!"+filePath.img.compImgCache+"*.tinypng-sigs",filePath.img.compImgCache+"**/*"]).pipe(gulp.dest(filePath.img.out))}),gulp.task("tinyPngHandler",function(){return gulp.src(filePath.img.in).pipe(plumber()).pipe(newer(filePath.img.compImgCache)).pipe(tinypng({key:filePath.img.tinyPngApiKey,log:!0})).pipe(gulp.dest(filePath.img.compImgCache))}),gulp.task("imgOflineHandler",function(){return gulp.src(filePath.img.in).pipe(newer(filePath.img.out)).pipe(imagemin([imagemin.gifsicle({interlaced:!0}),imagemin.mozjpeg({progressive:!0}),imageminJpegRecompress({loops:5,min:70,max:75,quality:"high"}),imagemin.svgo(),imagemin.optipng({optimizationLevel:3}),pngquant([.8,.8])],{verbose:!0})).pipe(gulp.dest(filePath.img.out))}),gulp.task("svg",function(){return gulp.src(filePath.svg.in).pipe(svgmin({js2svg:{pretty:!0}})).pipe(cheerio({run:function(e){e("[fill]").removeAttr("fill"),e("[stroke]").removeAttr("stroke"),e("[style]").removeAttr("style")},parserOptions:{xmlMode:!0}})).pipe(replace("&gt;",">")).pipe(svgSprite({mode:{symbol:{sprite:"sprite.svg"}}})).pipe(gulp.dest(filePath.svg.out))}),gulp.task("fonts",function(){return gulp.src(filePath.fonts.in).pipe(newer(filePath.fonts.out)).pipe(gulp.dest(filePath.fonts.out)).pipe(browserSync.stream())}),gulp.task("clearBuild",function(){return del(filePath.cleaner)}),gulp.task("watch",function(){browserSync.init(BrowserSyncConfig),gulp.watch("./src/**/*.pug",gulp.series("pug")),gulp.watch("./src/**/*.kit",gulp.series("kit")),gulp.watch("./src/**/*.scss",gulp.parallel("sassDev")),gulp.watch("./src/js/libs/*.js",gulp.parallel("libsDev")),gulp.watch("./src/js/*.js",gulp.parallel("scriptsDev")),gulp.watch("./src/img/**/*.{png,jpg,gif,svg}",gulp.parallel("imgOflineHandler")),gulp.watch("./src/img/svg/*.svg",gulp.parallel("svg")),gulp.watch("./src/fonts/**/*.",gulp.parallel("fonts"))}),gulp.task("dev",gulp.series("clearBuild",gulp.parallel("pug","kit","sassDev","libsDev","scriptsDev","imgOflineHandler","svg","fonts"))),gulp.task("build",gulp.series("clearBuild","pug","kit","sassBuild","libsBuild","scriptsBuild","imgOflineHandler","svg","fonts")),gulp.task("default",gulp.series("dev",gulp.parallel("watch")));